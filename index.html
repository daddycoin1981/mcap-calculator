<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üìà Memecoin PNL Calculator</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      
 <div id="summaryStats" style="margin-top: 30px; font-size: 1.1rem;">
    <p>‚úÖ <strong>Total Profit:</strong> $<span id="totalProfit">0.00</span> | <span id="totalProfitPct">0.00%</span></p>
    <p>‚ùå <strong>Total Loss:</strong> $<span id="totalLoss">0.00</span> | <span id="totalLossPct">0.00%</span></p>
  </div>
      
      background-color: #0b0f19;
      font-family: 'Arial Rounded MT Bold', sans-serif;
      color: #ffffff;
      text-align: center;
      padding: 30px;
    }
    table {
      margin: 20px auto;
      border-collapse: collapse;
      width: 95%;
      background-color: #121826;
    }
    th, td {
      padding: 10px;
      border: 1px solid #444;
      cursor: pointer;
    }
    th {
      background-color: #1f2a40;
      color: #00ffa3;
    }
    .loss-row { background-color: #4a1d1d; }
    canvas {
      margin-top: 40px;
      background-color: #1e1e2f;
      padding: 10px;
      border-radius: 10px;
    }
    #celebrate {
      font-size: 3em;
      color: #ffd700;
      display: none;
      animation: popper 1s ease-in-out;
    }
    @keyframes popper {
      0% { transform: scale(0.5); opacity: 0; }
      50% { transform: scale(1.5); opacity: 1; }
      100% { transform: scale(0.5); opacity: 0; }
    }
    .ticker {
      font-size: 1rem;
      margin-bottom: 10px;
    }
    .input-wrapper input {
      margin: 4px;
      padding: 6px;
      border-radius: 6px;
      border: none;
    }
    .input-wrapper button {
      padding: 6px 12px;
      border-radius: 6px;
      border: none;
      background-color: #00ffa3;
      color: #000;
      font-weight: bold;
      margin: 4px;
    }
    footer {
      margin-top: 50px;
      color: #888;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="ticker">
    ü™ô SOL Price: <span id="solPrice">...</span> | ‚Çø BTC Price: <span id="btcPrice">...</span>
  </div>

  <h1>üìà Memecoin PNL Calculator</h1>

  <div class="input-wrapper">
    <input id="coin" placeholder="üí† Coin Name" />
    <input id="investment" placeholder="üíµ Investment ($)" type="number" />
    <input id="entry" placeholder="üü¢ Entry MCAP" type="number" />
    <input id="exit" placeholder="üî¥ Exit MCAP" type="number" />
    <button onclick="addTrade()">Add Trade</button>
    <button onclick="exportToExcel()">Export to Excel</button>
  </div>

  <div id="celebrate">üéâ</div>

  <table>
    <thead>
      <tr>
        <th onclick="sortTable(0)">#</th>
        <th onclick="sortTable(1)">üìÖ Date</th>
        <th onclick="sortTable(2)">üí† Coin</th>
        <th onclick="sortTable(3)">üíµ Investment</th>
        <th onclick="sortTable(4)">üü¢ Entry MCAP</th>
        <th onclick="sortTable(5)">üî¥ Exit MCAP</th>
        <th onclick="sortTable(6)">üí∞ Profit ($)</th>
        <th onclick="sortTable(7)">üìà Profit (%)</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="historyBody"></tbody>
  </table>

  <canvas id="profitChart" height="100"></canvas>

   <footer>
    Developed by 10Solup | Contact: X/@10solup | YouTube/@10solup
  </footer>

  <script>
    let trades = JSON.parse(localStorage.getItem("trades") || "[]");
    let chart;
    let sortDir = {};

    const sound = new Howl({ src: ['https://assets.mixkit.co/sfx/preview/mixkit-small-group-cheer-and-applause-518.mp3'] });

    async function updatePrices() {
      const res = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=solana,bitcoin&vs_currencies=usd");
      const json = await res.json();
      document.getElementById("solPrice").innerText = `$${json.solana.usd}`;
      document.getElementById("btcPrice").innerText = `$${json.bitcoin.usd}`;
    }
    updatePrices(); setInterval(updatePrices, 10000);

    function sortTable(colIndex) {
      const table = document.getElementById("historyBody");
      const rows = Array.from(table.rows);
      const dir = sortDir[colIndex] === 'asc' ? 'desc' : 'asc';
      sortDir[colIndex] = dir;
      rows.sort((a, b) => {
        const valA = a.cells[colIndex].innerText.replace(/[^\d.-]/g, '');
        const valB = b.cells[colIndex].innerText.replace(/[^\d.-]/g, '');
        const isNum = !isNaN(valA) && !isNaN(valB);
        const result = isNum ? valA - valB : a.cells[colIndex].innerText.localeCompare(b.cells[colIndex].innerText);
        return dir === 'asc' ? result : -result;
      });
      table.innerHTML = '';
      rows.forEach(row => table.appendChild(row));
    }

    function addTrade() {
      const coin = document.getElementById("coin").value;
      const inv = parseFloat(document.getElementById("investment").value);
      const entry = parseFloat(document.getElementById("entry").value);
      const exit = parseFloat(document.getElementById("exit").value);
      const date = new Date().toISOString();
      if (!coin || isNaN(inv) || isNaN(entry) || isNaN(exit)) return;
      const profit = ((exit - entry) / entry) * inv;
      const percent = ((exit - entry) / entry) * 100;
      const netProfit = profit - 0.40; // default fee
      const obj = { coin, inv, entry, exit, profit: netProfit, percent, date };
      trades.unshift(obj);
      localStorage.setItem("trades", JSON.stringify(trades));
      renderTrades(trades);
      updateChart(trades);
      updateSummaryStats(trades);
      if (percent >= 100) {
        document.getElementById("celebrate").style.display = 'block';
        setTimeout(() => document.getElementById("celebrate").style.display = 'none', 1500);
        sound.play();
      }
    }

    function renderTrades(data) {
      const body = document.getElementById("historyBody");
      body.innerHTML = "";
      data.forEach((t, i) => {
        const row = document.createElement("tr");
        if (t.profit < 0) row.className = "loss-row";
        row.innerHTML = `
          <td>${i + 1}</td>
          <td>${new Date(t.date).toLocaleString()}</td>
          <td>${t.coin}</td>
          <td>$${t.inv.toFixed(2)}</td>
          <td>${t.entry}</td>
          <td>${t.exit}</td>
          <td>$${t.profit.toFixed(2)}</td>
          <td>${t.percent.toFixed(2)}%</td>
          <td>
            <button onclick="editTrade(${i})">Edit</button>
            <button onclick="deleteRow(${i})">Delete</button>
          </td>
        `;
        body.appendChild(row);
      });
      updateSummaryStats(data);
    }

    function deleteRow(index) {
      trades.splice(index, 1);
      localStorage.setItem("trades", JSON.stringify(trades));
      renderTrades(trades);
      updateChart(trades);
      updateSummaryStats(trades);
    }

    function editTrade(index) {
      const t = trades[index];
      document.getElementById("coin").value = t.coin;
      document.getElementById("investment").value = t.inv;
      document.getElementById("entry").value = t.entry;
      document.getElementById("exit").value = t.exit;
      deleteRow(index);
    }

    function updateChart(data) {
      const ctx = document.getElementById("profitChart").getContext("2d");
      const labels = data.map((_, i) => `T${data.length - i}`);
      const profits = data.map(t => t.profit).reverse();
      const tooltips = data.map(t => `$${t.profit.toFixed(2)} (${t.percent.toFixed(1)}%)`).reverse();
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [{
            label: 'Profit ($)',
            data: profits,
            borderColor: '#00ffa3',
            backgroundColor: 'rgba(0,255,163,0.1)',
            tension: 0.3,
            fill: true,
            pointBackgroundColor: profits.map(p => p >= 0 ? '#00ffa3' : '#ff4d4f')
          }]
        },
        options: {
          plugins: {
            tooltip: {
              callbacks: {
                label: function(context) {
                  const idx = context.dataIndex;
                  return tooltips[idx];
                }
              }
            }
          },
          scales: {
            y: {
              title: { display: true, text: 'Profit in $' }
            },
            x: {
              title: { display: true, text: 'Trade Count (T1 = Latest)' }
            }
          }
        }
      });
    }

    function updateSummaryStats(data) {
      const totalProfitTrades = data.filter(t => t.profit >= 0);
      const totalLossTrades = data.filter(t => t.profit < 0);
      const profitSum = totalProfitTrades.reduce((sum, t) => sum + t.profit, 0);
      const lossSum = totalLossTrades.reduce((sum, t) => sum + t.profit, 0);
      const profitPct = totalProfitTrades.reduce((sum, t) => sum + t.percent, 0);
      const lossPct = totalLossTrades.reduce((sum, t) => sum + t.percent, 0);
      document.getElementById("totalProfit").innerText = profitSum.toFixed(2);
      document.getElementById("totalLoss").innerText = Math.abs(lossSum).toFixed(2);
      document.getElementById("totalProfitPct").innerText = profitPct.toFixed(2) + "%";
      document.getElementById("totalLossPct").innerText = Math.abs(lossPct).toFixed(2) + "%";
    }

    function exportToExcel() {
      const ws = XLSX.utils.json_to_sheet(trades);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Trades");
      XLSX.writeFile(wb, "Memecoin_PNL_Calculator.xlsx");
    }

    renderTrades(trades);
    updateChart(trades);
    updateSummaryStats(trades);
  </script>
</body>
</html>
